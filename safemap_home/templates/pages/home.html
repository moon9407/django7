{% extends 'base.html' %}
{% block title %}SafeMap | 홈{% endblock %}
{% block content %}
{% load static %}
<section class="hero">
  <div class="badge">⚡ 요약·분류·위험도 → 지도 표시</div>
  <h1 class="h1">우리 동네 사건·사고,<br>한 줄로 요약해서 지도에</h1>
  <p class="sub">
    제보 내용을 기반으로 1줄 요약, 유형 분류, 위험도(1~5)를 자동 산출해
    누구나 빠르게 지역 안전 신호를 볼 수 있게 합니다.
  </p>
  <div class="btnrow">
    <a class="btn primary" href="{% url 'reports:new' %}">+ 제보 등록</a>
    <a class="btn" href="{% url 'reports:map' %}">🗺️ 지도 보기</a>
    <a class="btn" href="{% url 'chatbot:chat' %}">💬 챗봇 상담</a>
  </div>
</section>

<section class="grid grid-3" style="margin-top:18px;">
  <div class="card kpi">
    <div>
      <div class="small">최근 7일 제보</div>
      <div class="num">{{ last7 }}</div>
    </div>
    <div class="badge">📆 7 days</div>
  </div>
  <div class="card kpi">
    <div>
      <div class="small">최근 30일 제보</div>
      <div class="num">{{ last30 }}</div>
    </div>
    <div class="badge">🗓️ 30 days</div>
  </div>
  <div class="card kpi">
    <div>
      <div class="small">최근 7일 평균 위험도</div>
      <div class="num">{{ avg_risk_7 }}</div>
    </div>
    <div class="badge">⭐ 1~5</div>
  </div>
</section>

<section class="grid grid-3" style="margin-top:16px;">
  <div class="card">
    <h3>🧠 AI 요약</h3>
    <div class="small">긴 제보를 1줄로 압축해 “한 눈에” 보이게.</div>
  </div>
  <div class="card">
    <h3>🏷️ 자동 분류</h3>
    <div class="small">교통/폭력/분실/화재 등 유형을 자동 판단.</div>
  </div>
  <div class="card">
    <h3>⚠️ 위험도 점수</h3>
    <div class="small">1~5 점으로 우선 확인할 사건을 정리.</div>
  </div>
</section>

<!-- 챗봇 버튼 -->
<button id="chatbotBtn" class="chatbot-btn" aria-label="챗봇 열기">
  <img src="{% static 'images/chatbot.png' %}" style="width: 45px; height: 45px;" alt="챗봇 아이콘">
</button>
<!-- 챗봇 팝업창 -->
<div id="chatbotPopup" class="chatbot-popup" aria-hidden="true">
  <div class="chatbot-header">
    <span>챗봇 상담</span>
    <button id="chatbotCloseBtn" aria-label="챗봇 닫기">×</button>
  </div>
  <div class="chatbot-body">
    <!-- 여기에 챗봇 iframe 또는 UI 삽입 -->
    <iframe src="{% url 'chatbot:chat' %}" style="width:100%; height:300px; border:none;"></iframe>
  </div>
</div>


<script>
  const chatbotBtn = document.getElementById('chatbotBtn');
  const chatbotPopup = document.getElementById('chatbotPopup');
  const chatbotCloseBtn = document.getElementById('chatbotCloseBtn');

  chatbotBtn.addEventListener('click', () => {
    const isHidden = chatbotPopup.getAttribute('aria-hidden') === 'true';
    chatbotPopup.setAttribute('aria-hidden', isHidden ? 'false' : 'true');
  });

  chatbotCloseBtn.addEventListener('click', () => {
    chatbotPopup.setAttribute('aria-hidden', 'true');
  });
</script>

{% endblock %}

